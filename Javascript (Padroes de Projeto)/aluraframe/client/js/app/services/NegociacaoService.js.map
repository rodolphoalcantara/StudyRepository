{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","_http","Promise","all","obterNegociacoesDaSemana","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","then","negociacoes","periodos","reduce","dados","periodo","concat","map","Date","dado","data","quantidade","valor","catch","Error","erro","get","obj","console","log","error","negociacao","getConnection","connection","dao","add","listAll","clearAll","actualList","obterNegociacoes","filter","some","isEquals","negociacaoExistente"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\r\nimport {ConnectionFactory} from './ConnectionFactory';\r\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\r\nimport {Negociacao} from '../models/Negociacao';\r\n\r\nexport class NegociacaoService {\r\n\r\n  constructor() {\r\n    this._http = new HttpService();\r\n  }\r\n\r\n  obterNegociacoes() {\r\n    return Promise.all([\r\n      this.obterNegociacoesDaSemana(),\r\n      this.obterNegociacoesDaSemanaAnterior(),\r\n      this.obterNegociacoesDaSemanaRetrasada()\r\n  ]).then(periodos => {\r\n      let negociacoes = periodos\r\n          .reduce((dados, periodo) => dados.concat(periodo), [])\r\n          .map(dado => new Negociacao(new Date(dado.data), dado.quantidade, dado.valor ));\r\n\r\n      return negociacoes;\r\n  }).catch(erro => {\r\n      throw new Error(erro);\r\n  });\r\n} \r\n\r\n  obterNegociacoesDaSemana() {\r\n      return this._http\r\n        .get('negociacoes/semana')\r\n        .then(negociacoes => {\r\n          return negociacoes.map(obj => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          throw new Error('Não foi possível obter as negociações da semana.');\r\n        })\r\n    };\r\n\r\n  obterNegociacoesDaSemanaAnterior() {\r\n      return this._http\r\n        .get('negociacoes/anterior')\r\n        .then(negociacoes => {\r\n          return negociacoes.map(obj => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          throw new Error('Não foi possível obter as negociações da semana anterior.');\r\n        })\r\n    };\r\n\r\n  obterNegociacoesDaSemanaRetrasada() {\r\n      return this._http\r\n        .get('negociacoes/retrasada')\r\n        .then(negociacoes => {\r\n          return negociacoes.map(obj => new Negociacao(new Date(obj.data), obj.quantidade, obj.valor));\r\n        })\r\n        .catch(error => {\r\n          console.log(error);\r\n          throw new Error('Não foi possível obter as negociações da semana retrasada.');\r\n        })\r\n  };\r\n\r\n  register(negociacao){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.add(negociacao))\r\n      .then(() => 'Negociação adicionada com sucesso')\r\n      .catch(error => {\r\n        console.log(error)\r\n        throw new Error('Não foi possível adicionar a negociação')\r\n      })\r\n  }\r\n\r\n  list(){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.listAll())\r\n      .catch(error => {\r\n        console.log(error)\r\n        throw new Error('Não foi possível obter as negociacoes');\r\n      })\r\n  }\r\n\r\n  clear(){\r\n    return ConnectionFactory\r\n      .getConnection()\r\n      .then(connection => new NegociacaoDao(connection))\r\n      .then(dao => dao.clearAll())\r\n      .then(() => 'Negociações apagadas com sucesso')\r\n      .catch(error => {\r\n        console.log(error)\r\n        throw new Error('Não foi possível apagar as negociações')\r\n      })\r\n  }\r\n\r\n  import(actualList){\r\n    return this.obterNegociacoes()\r\n      .then(negociacoes => \r\n        negociacoes.filter(negociacao => \r\n          !actualList.some(negociacaoExistente => negociacao.isEquals(negociacaoExistente))))\r\n      .catch(error => {\r\n        console.log(error)\r\n        throw new Error('Não foi possível buscar negociações para importar')\r\n      })\r\n  }\r\n\r\n\r\n\r\n}"]}
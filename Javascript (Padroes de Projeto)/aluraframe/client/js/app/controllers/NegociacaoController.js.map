{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["currentInstance","negociacaoController","ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputDate","_inputAmount","_inputValue","_listaNegociacoes","_mensagem","_actualOrder","_service","_init","list","then","negociacoes","forEach","add","negociacao","catch","text","error","setInterval","importaNegociacoes","event","preventDefault","_createNegociacao","register","mensagem","_limpaFormulario","import","texto","erro","clear","msg","convertForDate","value","parseInt","parseFloat","focus","column","revertSort","sortList","a","b"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\r\nimport {Mensagem} from '../models/Mensagem';\r\nimport {NegociacoesView} from '../views/NegociacoesView';\r\nimport {MensagemView} from '../views/MensagemView';\r\nimport {NegociacaoService} from '../services/NegociacaoService';\r\nimport {DateHelper} from '../helpers/DateHelper';\r\nimport {Bind} from '../helpers/Bind';\r\nimport {Negociacao} from '../models/Negociacao';\r\n\r\nclass NegociacaoController {\r\n\r\n  constructor() {\r\n    // o metodo bind passando document como parametro, faz com que o querySelector continue pertencendo ao\r\n    //document mesmo que agora dentro de uma variavel.\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputDate = $('#data');\r\n    this._inputAmount = $('#quantidade');\r\n    this._inputValue = $('#valor');\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($('#negociacoesView')),\r\n      'add', 'clear', 'sortList', 'revertSort');\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($('#mensagemView')),\r\n      'text');\r\n\r\n    this._actualOrder = '';\r\n    this._service = new NegociacaoService();\r\n    \r\n    this._init();\r\n  }\r\n\r\n  _init(){\r\n    this._service\r\n      .list()\r\n      .then(negociacoes => \r\n        negociacoes.forEach(negociacao => \r\n          this._listaNegociacoes.add(negociacao)))\r\n      .catch(error => this._mensagem.text = error)\r\n\r\n      setInterval(() => {\r\n        this.importaNegociacoes();\r\n      }, 3000)\r\n  }\r\n\r\n  add(event) {\r\n    event.preventDefault();\r\n    let negociacao = this._createNegociacao();\r\n\r\n    this._service\r\n      .register(negociacao)\r\n      .then(mensagem => {\r\n        this._listaNegociacoes.add(negociacao)\r\n        this._mensagem.text = mensagem;\r\n        this._limpaFormulario()\r\n      })\r\n      .catch(error => this._mensagem.text = error);\r\n    }\r\n\r\n  importaNegociacoes() {\r\n    this._service\r\n    .import(this._listaNegociacoes.negociacoes)\r\n      .then(negociacoes => negociacoes.forEach(negociacao => {\r\n          this._listaNegociacoes.add(negociacao);\r\n          this._mensagem.texto = 'Negociações do período importadas'   \r\n      }))\r\n      .catch(erro => this._mensagem.texto = erro);\r\n\r\n  }\r\n\r\n  delete() {\r\n\r\n    this._service\r\n      .clear()\r\n      .then(msg =>{\r\n        this._mensagem.text = msg\r\n        this._listaNegociacoes.clear();\r\n      })\r\n      .catch(error => this._mensagem.text = error);\r\n  }\r\n\r\n  _createNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.convertForDate(this._inputDate.value),\r\n      parseInt(this._inputAmount.value),\r\n      parseFloat(this._inputValue.value)\r\n    );\r\n\r\n  }\r\n  _limpaFormulario() {\r\n    this._inputDate.value = '';\r\n    this._inputAmount.value = 1;\r\n    this._inputValue.value = 0.0;\r\n\r\n    this._inputDate.focus();\r\n  }\r\n\r\n  sortList(column){\r\n    if(this._actualOrder == column){\r\n      this._listaNegociacoes.revertSort();\r\n    }else{\r\n      this._listaNegociacoes.sortList((a,b) => a[column] - b[column])\r\n    }\r\n    this._actualOrder = column;\r\n  }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\nexport function currentInstance(){\r\n  return negociacaoController;\r\n}"]}